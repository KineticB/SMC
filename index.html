<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì í¬ ê´€ë¦¬ ì»¨ì„¤íŒ… ë¦¬í¬íŠ¸</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        /* í°íŠ¸ ë° ì»¬ëŸ¬ ë³€ìˆ˜ ì •ì˜ */
        :root {
            --brand-green: #00782b;
            --brand-choco: #604c3e;
            --brand-cream: #f7f3e8;
            --brand-red: #ce1126;
            --brand-blue: #005eb8;
            --white: #ffffff;
            --border-radius: 12px;
        }

        body {
            font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            background-color: var(--brand-cream);
            color: var(--brand-choco);
            margin: 0;
            padding: 20px;
            padding-bottom: 80px;
            line-height: 1.5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header-logo {
            text-align: center;
            background-color: var(--brand-green);
            color: var(--white);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-bottom: 5px solid #005a20;
        }

        .header-logo h1 {
            margin: 0;
            font-size: 1.6rem;
            letter-spacing: -1px;
            line-height: 1.2;
        }

        /* ì„¹ì…˜(STEP) ìŠ¤íƒ€ì¼ */
        .step-section {
            background: var(--white);
            border: 2px solid var(--brand-green);
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            overflow: hidden;
            box-shadow: 4px 4px 0px rgba(0, 120, 43, 0.1);
        }

        .step-header {
            background-color: var(--brand-green);
            color: var(--white);
            padding: 12px 20px;
            font-size: 1.1em;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .step-header::before {
            content: 'ğŸ©';
            margin-right: 10px;
            font-size: 1.2em;
        }

        .step-content {
            padding: 20px;
        }

        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .form-item {
            margin-bottom: 25px;
            border-bottom: 1px dashed #ddd;
            padding-bottom: 20px;
        }

        .form-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        label.item-title {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--brand-green);
            font-size: 1.05em;
        }

        .sub-desc {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 12px;
            background: #f9f9f9;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
        }

        /* í…ìŠ¤íŠ¸ ì…ë ¥ì°½ ë° ì…€ë ‰íŠ¸ ë°•ìŠ¤ */
        input[type="text"], 
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
            background-color: #fdfdfd;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--brand-green);
            background-color: #fff;
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2300782b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
        }

        /* ê³µí†µ ë¼ë””ì˜¤/ì²´í¬ë°•ìŠ¤ ë˜í¼ ìŠ¤íƒ€ì¼ */
        .option-wrapper {
            display: flex;
            gap: 20px;
            align-items: center;
            background: #f0f7f2;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
        }

        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            color: var(--brand-choco);
        }
        
        .radio-label input {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            accent-color: var(--brand-green);
        }

        /* ì ìˆ˜ ì„ íƒ (1~5ì ) ë¼ë””ì˜¤ ë²„íŠ¼ */
        .rating-wrapper {
            display: flex;
            justify-content: space-between;
            background: #f0f7f2;
            padding: 10px 15px;
            border-radius: 30px;
            margin-bottom: 10px;
            border: 1px solid var(--brand-green);
        }

        .rating-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.85em;
            cursor: pointer;
            font-weight: bold;
            color: var(--brand-green);
        }

        .rating-item input {
            margin-bottom: 5px;
            width: 18px; 
            height: 18px;
            accent-color: var(--brand-green);
        }

        /* ìˆ«ì ì…ë ¥ ê·¸ë£¹ */
        .input-group-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .input-box {
            flex: 1;
            min-width: 140px;
        }
        
        .input-box label {
            display: block;
            font-size: 0.85em;
            margin-bottom: 5px;
            color: var(--brand-choco);
            font-weight: bold;
        }

        .input-with-unit {
            position: relative;
        }
        
        .input-with-unit input {
            padding-right: 45px; 
            text-align: right;
            font-weight: bold;
            color: var(--brand-green);
        }
        
        .input-with-unit span {
            position: absolute;
            right: 12px;
            top: 14px;
            color: #999;
            font-size: 0.9em;
            font-weight: bold;
        }

        /* íŒŒì¼ ì—…ë¡œë“œ */
        .file-upload-box {
            background: #fff;
            padding: 10px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            margin-top: 5px;
            text-align: center;
        }
        .file-upload-box:hover {
            border-color: var(--brand-green);
            background: #f0f7f2;
        }

        /* ì²´í¬ë°•ìŠ¤ ë””ìì¸ */
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            background: #fff;
            padding: 10px;
            border: 2px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .checkbox-wrapper:hover {
            border-color: var(--brand-green);
        }
        .checkbox-wrapper input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            accent-color: var(--brand-green);
        }
        .checkbox-wrapper label {
            font-weight: bold;
            cursor: pointer;
            width: 100%;
        }

        /* ìˆ¨ê¹€ ì˜ì—­ (ì¡°ê±´ë¶€ í‘œì‹œ) */
        .hidden-area {
            display: none;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-top: 10px;
        }

        /* í•˜ë‹¨ ê³ ì • ë²„íŠ¼ ê·¸ë£¹ */
        .btn-group {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
            box-sizing: border-box;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .btn {
            flex: 1;
            padding: 15px;
            font-size: 1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        
        .btn:active {
            transform: scale(0.98);
        }

        .btn-save { 
            background-color: var(--brand-choco); 
            box-shadow: 0 4px 0 #4a3b30;
        }
        .btn-email {
            background-color: var(--brand-blue);
            box-shadow: 0 4px 0 #003d7a;
        }
        .btn-reset { 
            background-color: var(--brand-red); 
            max-width: 80px; 
            font-size: 0.9em; 
            box-shadow: 0 4px 0 #a00e1e;
        }

        @media (max-width: 600px) {
            .input-group-row { flex-direction: column; gap: 10px; }
            .rating-wrapper { padding: 8px; }
            .rating-item { font-size: 0.75em; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-logo">
        <h1>STORE MANAGEMENT<br>CONSULTING REPORT</h1>
        <div style="font-size: 0.9em; opacity: 0.9; margin-top:5px;">ì í¬ ê´€ë¦¬ ì»¨ì„¤íŒ… ë¦¬í¬íŠ¸</div>
    </div>

    <form id="inspectionForm">

        <div class="step-section">
            <div class="step-header">Step 0. ë‹´ë‹¹ ì§€ì  ë° SC</div>
            <div class="step-content">
                <div class="input-group-row">
                    <div class="input-box">
                        <label>ğŸ¢ ë‹´ë‹¹ ì§€ì </label>
                        <select id="branchSelect" name="branch_name">
                            <option value="">ì§€ì  ì„ íƒ</option>
                            <option value="ì¤‘ë¶€1ì§€ì ">ì¤‘ë¶€1ì§€ì </option>
                            <option value="ì¤‘ë¶€2ì§€ì ">ì¤‘ë¶€2ì§€ì </option>
                            <option value="ì„œë¶€ì§€ì ">ì„œë¶€ì§€ì </option>
                            <option value="ë™ë¶€ì§€ì ">ë™ë¶€ì§€ì </option>
                        </select>
                    </div>
                    <div class="input-box">
                        <label>ğŸ‘¤ ë‹´ë‹¹ SC</label>
                        <select id="scSelect" name="sc_name">
                            <option value="">ì§€ì ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="step-section">
            <div class="step-header">Step 1. ì ê²€ ì‹œì‘ ì „ (ì‹œì„¤/í™˜ê²½)</div>
            <div class="step-content">
                <p class="sub-desc" style="display:block; background:#fff3cd; color:#856404; border:1px solid #ffeeba;">â€» 1ì (ë‚˜ì¨) ~ 5ì (ì¢‹ìŒ) í‰ê°€ ë° ë¶ˆëŸ‰ ì‹œ ì‚¬ì§„ ë“±ë¡</p>
                
                <div class="form-item">
                    <label class="item-title" id="title_s1_1">1. ì í¬ ì™¸ê´€ (ë…¸í›„ìƒíƒœ)</label>
                    <div class="rating-wrapper">
                        <label class="rating-item"><input type="radio" name="s1_1_score" value="1">1ì </label>
                        <label class="rating-item"><input type="radio" name="s1_1_score" value="2">2ì </label>
                        <label class="rating-item"><input type="radio" name="s1_1_score" value="3">3ì </label>
                        <label class="rating-item"><input type="radio" name="s1_1_score" value="4">4ì </label>
                        <label class="rating-item"><input type="radio" name="s1_1_score" value="5">5ì </label>
                    </div>
                    <div class="file-upload-box">
                        <input type="file" name="file_s1_1" id="file_s1_1" accept="image/*" capture="camera">
                    </div>
                </div>

                <div class="form-item">
                    <label class="item-title" id="title_s1_2">2. ì í¬ ë‚´ë¶€ (ì •ë¦¬ìƒíƒœ)</label>
                    <div class="rating-wrapper">
                        <label class="rating-item"><input type="radio" name="s1_2_score" value="1">1ì </label>
                        <label class="rating-item"><input type="radio" name="s1_2_score" value="2">2ì </label>
                        <label class="rating-item"><input type="radio" name="s1_2_score" value="3">3ì </label>
                        <label class="rating-item"><input type="radio" name="s1_2_score" value="4">4ì </label>
                        <label class="rating-item"><input type="radio" name="s1_2_score" value="5">5ì </label>
                    </div>
                    <div class="file-upload-box">
                        <input type="file" name="file_s1_2" id="file_s1_2" accept="image/*" capture="camera">
                    </div>
                </div>

                <div class="form-item">
                    <label class="item-title" id="title_s1_3">3. ê³ ì§€ë¬¼ ì ê²€ (ë…¸í›„/ë¶ˆí•„ìš” ì œê±°)</label>
                    <div class="rating-wrapper">
                        <label class="rating-item"><input type="radio" name="s1_3_score" value="1">1ì </label>
                        <label class="rating-item"><input type="radio" name="s1_3_score" value="2">2ì </label>
                        <label class="rating-item"><input type="radio" name="s1_3_score" value="3">3ì </label>
                        <label class="rating-item"><input type="radio" name="s1_3_score" value="4">4ì </label>
                        <label class="rating-item"><input type="radio" name="s1_3_score" value="5">5ì </label>
                    </div>
                    <div class="file-upload-box">
                        <input type="file" name="file_s1_3" id="file_s1_3" accept="image/*" capture="camera">
                    </div>
                </div>

                <div class="form-item">
                    <label class="item-title" id="title_s1_4">4. ê¸°ê¸° ê³ ì¥ ë° êµì²´ í•„ìš” ì‚¬í•­</label>
                    <div class="rating-wrapper">
                        <label class="rating-item"><input type="radio" name="s1_4_score" value="1">1ì </label>
                        <label class="rating-item"><input type="radio" name="s1_4_score" value="2">2ì </label>
                        <label class="rating-item"><input type="radio" name="s1_4_score" value="3">3ì </label>
                        <label class="rating-item"><input type="radio" name="s1_4_score" value="4">4ì </label>
                        <label class="rating-item"><input type="radio" name="s1_4_score" value="5">5ì </label>
                    </div>
                    <div class="file-upload-box">
                        <input type="file" name="file_s1_4" id="file_s1_4" accept="image/*" capture="camera">
                    </div>
                </div>
            </div>
        </div>

        <div class="step-section">
            <div class="step-header">Step 2. ë§¤ì¶œ ê´€ë ¨</div>
            <div class="step-content">
                
                <div class="form-item">
                    <label class="item-title">1. ëª©í‘œë§¤ì¶œ ë° ì‹¤ì  ì ê²€</label>
                    <div class="sub-desc">ì™¸ë¶€ì±„ë„ ì œì™¸ í›„ ì‹¤ì  ë° ì‹œê°„ëŒ€ ë§¤ì¶œ ì ê²€</div>
                    <textarea name="s2_1_comment" placeholder="íŠ¹ì´ì‚¬í•­ ë° ë¶„ì„ ë‚´ìš© ì…ë ¥"></textarea>
                </div>

                <div class="form-item">
                    <label class="item-title">2. ì‹ ì œí’ˆ íŒë§¤ ì‹¤ì  ë° íŒì´‰ë¬¼ ì ê²€</label>
                    <div class="input-group-row">
                        <div class="input-box">
                            <label>ğŸ© ì‹ ì œí’ˆ ë¹„ìœ¨</label>
                            <div class="input-with-unit">
                                <input type="number" name="s2_2_ratio" placeholder="0"><span>%</span>
                            </div>
                        </div>
                        <div class="input-box">
                            <label>ğŸ“ˆ í‰ê·  ëŒ€ë¹„ ì¦ê°ìœ¨</label>
                            <div class="input-with-unit">
                                <input type="number" name="s2_2_increase" placeholder="0"><span>%</span>
                            </div>
                        </div>
                    </div>
                    <textarea name="s2_2_comment" placeholder="ì¦ê° ì›ì¸ ë° ìƒì„¸ ë¶„ì„"></textarea>
                </div>

                <div class="form-item">
                    <label class="item-title">3. ì œí’ˆ í’ˆì ˆì‹œê°„ ë° ë°œì£¼ëŸ‰ ì ê²€</label>
                    <textarea name="s2_3_comment" placeholder="ë°œì£¼ ì ì •ì„± ë° í’ˆì ˆ ê´€ë ¨ ì½”ë©˜íŠ¸"></textarea>
                </div>

                <div class="form-item">
                    <label class="item-title">4. ë„ë„› íê¸° ì‹¤ì  ë° ë°°ë‹¬ ì‹¤ì  ì ê²€</label>
                    <div class="input-group-row">
                        <div class="input-box">
                            <label>ğŸ—‘ï¸ íê¸°ìœ¨</label>
                            <div class="input-with-unit">
                                <input type="number" name="s2_4_waste" step="0.1" placeholder="0"><span>%</span>
                            </div>
                        </div>
                        <div class="input-box">
                            <label>ğŸ›µ í‰ê·  ë°°ë‹¬ í’ˆì ˆì‹œê°„</label>
                            <select name="s2_4_time">
                                <option value="">ì‹œê°„ ì„ íƒ</option>
                                <option value="13:00">13:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:00">15:00</option>
                                <option value="16:00">16:00</option>
                                <option value="17:00">17:00</option>
                                <option value="18:00">18:00</option>
                                <option value="19:00">19:00</option>
                                <option value="20:00">20:00</option>
                                <option value="21:00">21:00</option>
                            </select>
                        </div>
                    </div>
                    <textarea name="s2_4_comment" placeholder="íê¸° ë° ë°°ë‹¬ ê´€ë ¨ ìƒì„¸ ì½”ë©˜íŠ¸"></textarea>
                </div>

                <div class="form-item">
                    <label class="item-title">5. íŒì´‰ ìš´ì˜ (ì í¬íŒì´‰ / CRM / ì™¸ë¶€ì±„ë„)</label>
                    <textarea name="s2_5_comment" placeholder="íŒì´‰ ì„±ê³¼ ë° í–¥í›„ ìš´ì˜ ê³„íš"></textarea>
                </div>

            </div>
        </div>

        <div class="step-section">
            <div class="step-header">Step 3. ì†ìµ ê´€ë ¨</div>
            <div class="step-content">
                <div class="form-item">
                    <label class="item-title">1. ì†ìµ ë¶€ì§„ì  ìš´ì˜í˜„í™© ë° í™œì„±í™”/ì ˆê° ë°©ì•ˆ</label>
                    <textarea name="s3_1_comment" placeholder="ë§¤ì¶œ í™œì„±í™” ë°©ì•ˆ ë° ë¹„ìš© ì ˆê° ì•„ì´ë””ì–´"></textarea>
                </div>
                <div class="form-item">
                    <label class="item-title">2. ì†ìµ ë¶„ì„ (ì˜ì—…ì´ìµ ì ì ì›ì¸)</label>
                    <textarea name="s3_2_comment" placeholder="ì ì ì‚¬ìœ  ë° êµ¬ì²´ì  ì›ì¸ íŒŒì•…"></textarea>
                </div>
                <div class="form-item">
                    <label class="item-title">3. ìì²´ ì†ìµ (ì™¸ë¶€ì±„ë„ ì œì™¸) ê°œì„  ë°©ì•ˆ</label>
                    <textarea name="s3_3_comment" placeholder="ì í¬ ìì²´ ì†ìµ ê°œì„  ë°©ì•ˆ"></textarea>
                </div>
            </div>
        </div>

        <div class="step-section">
            <div class="step-header">Step 4. ì¸ì‚¬ ë° ê¸°íƒ€ ì ê²€</div>
            <div class="step-content">
                <div class="form-item">
                    <label class="item-title">1. ì¸ë ¥ ìš´ì˜ ì ì •ì„± (52ì‹œê°„, ì¸ê±´ë¹„ ë“±)</label>
                    <label style="font-size:0.9em; margin-bottom:5px; display:block;">Q. ì „ì§ì› ì£¼ 52ì‹œê°„ ì´ˆê³¼ ì—¬ë¶€</label>
                    <div class="option-wrapper">
                        <label class="radio-label">
                            <input type="radio" name="s4_overtime" value="ì˜ˆ"> ì˜ˆ
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="s4_overtime" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤
                        </label>
                    </div>
                    <textarea name="s4_1_comment" placeholder="ì¸ë ¥ ìš´ì˜ ê´€ë ¨ ì½”ë©˜íŠ¸"></textarea>
                </div>

                <div class="form-item">
                    <label class="item-title">2. ì§ì› ë©´ë‹´ ë° SHIFT ì ê²€</label>
                    
                    <label style="font-size:0.9em; margin-bottom:5px; display:block;">Q. ì§ì› ìŠ¤ì¼€ì¤„ ì£¼ 6ì¼ ê·¼ë¬´ ë°œìƒ ì—¬ë¶€</label>
                    <div class="option-wrapper">
                        <label class="radio-label">
                            <input type="radio" name="s4_work6days" value="ì˜ˆ"> ì˜ˆ
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="s4_work6days" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤
                        </label>
                    </div>

                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="interview_check" name="s4_interview_yn">
                        <label for="interview_check">ì§ì› ë©´ë‹´ ì§„í–‰ ì—¬ë¶€ (ì²´í¬ ì‹œ ì…ë ¥ì°½ í™œì„±í™”)</label>
                    </div>

                    <div id="interview_area" class="hidden-area">
                        <div class="input-group-row">
                            <div class="input-box">
                                <label>ì í¬ëª…</label>
                                <input type="text" name="interview_store">
                            </div>
                            <div class="input-box">
                                <label>ì´ë¦„</label>
                                <input type="text" name="interview_name">
                            </div>
                            <div class="input-box">
                                <label>ì§ì±…</label>
                                <input type="text" name="interview_position">
                            </div>
                        </div>
                        <label style="font-size:0.9em; margin-top:10px; display:block;">ğŸ“· ë©´ë‹´ ì¼ì§€ ì‚¬ì§„ ë“±ë¡</label>
                        <div class="file-upload-box">
                            <input type="file" name="file_interview" id="file_interview" accept="image/*" capture="camera">
                        </div>
                    </div>

                    <textarea name="s4_2_comment" placeholder="ê¸°íƒ€ ì¸ì‚¬/ìŠ¤ì¼€ì¤„ ê´€ë ¨ ì½”ë©˜íŠ¸" style="margin-top:15px;"></textarea>
                </div>
            </div>
        </div>

        <div class="step-section">
            <div class="step-header">Step 5. ìƒì‚°í˜• ì í¬ ìˆ˜ìœ¨ ë° ê°œë‹¹ ì¸ê±´ë¹„ í™•ì¸</div>
            <div class="step-content">
                
                <div class="form-item">
                    <label class="item-title">1. ìƒì‚°í˜• ì í¬ ìˆ˜ìœ¨ ë° ê°œë‹¹ ì¸ê±´ë¹„</label>
                    
                    <div class="input-group-row">
                        <div class="input-box">
                            <label>ğŸ¥£ ë¯¹ìŠ¤ ìˆ˜ìœ¨</label>
                            <div class="input-with-unit">
                                <input type="number" name="s5_yield_mix" placeholder="0"><span>%</span>
                            </div>
                        </div>
                        <div class="input-box">
                            <label>ğŸ© 6X ìˆ˜ìœ¨</label>
                            <div class="input-with-unit">
                                <input type="number" name="s5_yield_6x" placeholder="0"><span>%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-group-row">
                        <div class="input-box">
                            <label>ğŸ¬ ì •ë°±ë‹¹ ìˆ˜ìœ¨</label>
                            <div class="input-with-unit">
                                <input type="number" name="s5_yield_sugar" placeholder="0"><span>%</span>
                            </div>
                        </div>
                        <div class="input-box">
                            <label>ğŸ’° ê°œë‹¹ ì¸ê±´ë¹„</label>
                            <div class="input-with-unit">
                                <input type="number" name="s5_labor_cost" placeholder="0"><span>ì›</span>
                            </div>
                        </div>
                    </div>

                    <textarea name="s5_1_comment" placeholder="ìˆ˜ìœ¨ ë° ìƒì‚°ì„± ë¶„ì„ ë‚´ìš©"></textarea>
                </div>

                <div class="form-item">
                    <label class="item-title">2. ì œì¡°ì¶œê³  ì˜ì—…ì  ê¸°ê¸° ìƒíƒœ ë° ìˆ˜ë¦¬ í™•ì¸</label>
                    <div class="file-upload-box">
                        <input type="file" name="file_s5_machine" id="file_s5_machine" accept="image/*" capture="camera">
                    </div>
                    <textarea name="s5_2_comment" placeholder="ê¸°ê¸° ìƒíƒœ ì½”ë©˜íŠ¸" style="margin-top:10px;"></textarea>
                </div>

                <div class="form-item">
                    <label class="item-title">3. ì œì¡°ì  í•´ì„­(HACCP) ì„œë¥˜ í™•ì¸</label>
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="haccp_check" name="haccp_yn">
                        <label for="haccp_check">HACCP ê´€ë ¨ ì„œë¥˜ ë¹„ì¹˜ ë° ì‘ì„± í™•ì¸ ì™„ë£Œ</label>
                    </div>
                    <textarea name="s5_3_comment" placeholder="HACCP ê´€ë ¨ íŠ¹ì´ì‚¬í•­ ë©”ëª¨"></textarea>
                </div>

            </div>
        </div>

    </form>

    <div class="btn-group">
        <button type="button" class="btn btn-reset" onclick="resetForm()">ì´ˆê¸°í™”</button>
        <button type="button" class="btn btn-save" onclick="saveAsExcel()">ì—‘ì…€ ì €ì¥</button>
        <button type="button" class="btn btn-email" onclick="sendEmail()">ì´ë©”ì¼ ì „ì†¡</button>
    </div>
</div>

<script>
    const scList = {
        "ì¤‘ë¶€1ì§€ì ": ["ì •ì§€ì„± SC", "ê°•ë¯¸ì˜¥ SC"],
        "ì¤‘ë¶€2ì§€ì ": ["ì¥ë¬¸ê·¼ SC", "ì´ì¢…í˜„ SC"],
        "ì„œë¶€ì§€ì ": ["ì†¡ì •í›ˆ SC", "ê°•ì¸êµ¬ SC"],
        "ë™ë¶€ì§€ì ": ["ì„±ë™ì—° SC", "ì±„ì„±ìš° SC"]
    };

    document.getElementById("branchSelect").addEventListener("change", function() {
        const branch = this.value;
        const scSelect = document.getElementById("scSelect");
        scSelect.innerHTML = '<option value="">SC ì„ íƒ</option>'; 
        if (branch && scList[branch]) {
            scList[branch].forEach(function(sc) {
                const option = document.createElement("option");
                option.value = sc;
                option.textContent = sc;
                scSelect.appendChild(option);
            });
        }
    });

    document.getElementById("interview_check").addEventListener("change", function() {
        const area = document.getElementById("interview_area");
        area.style.display = this.checked ? "block" : "none";
    });

    function resetForm() {
        if(confirm("ì‘ì„±ëœ ëª¨ë“  ë‚´ìš©ì„ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            document.getElementById("inspectionForm").reset();
            document.getElementById("interview_area").style.display = "none";
            window.scrollTo(0,0);
        }
    }

    // ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• ë° Base64 ë³€í™˜ í•¨ìˆ˜
    async function getResizedImageData(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    const max_size = 600; 

                    if (width > max_size) {
                        height *= max_size / width;
                        width = max_size;
                    }
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    resolve(canvas.toDataURL('image/jpeg', 0.7)); 
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    // ì—‘ì…€ ìŠ¤íƒ€ì¼ ê°€ì´ë“œ
    const applySectionStyle = (cell) => {
        cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF00782B' } };
        cell.font = { name: 'Malgun Gothic', color: { argb: 'FFFFFFFF' }, bold: true, size: 12 };
        cell.alignment = { horizontal: 'center', vertical: 'middle' };
        cell.border = { bottom: { style: 'medium', color: { argb: 'FF005A20' } } };
    };

    const applyLabelStyle = (cell) => {
        cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFF0F7F2' } };
        cell.font = { name: 'Malgun Gothic', color: { argb: 'FF00782B' }, bold: true };
        cell.alignment = { vertical: 'middle' };
        cell.border = { top: {style:'thin'}, left: {style:'thin'}, bottom: {style:'thin'}, right: {style:'thin'} };
    };

    const applyValueStyle = (cell) => {
        cell.font = { name: 'Malgun Gothic', color: { argb: 'FF604C3E' } };
        cell.alignment = { vertical: 'middle', wrapText: true };
        cell.border = { top: {style:'thin'}, left: {style:'thin'}, bottom: {style:'thin'}, right: {style:'thin'} };
    };

    async function generateExcelFile() {
        const form = document.getElementById('inspectionForm');
        const formData = new FormData(form);
        const branch = formData.get('branch_name') || "ë¯¸ì„ íƒ";
        const sc = formData.get('sc_name') || "ë¯¸ì„ íƒ";
        const fileName = `${branch}_${sc}_ì»¨ì„¤íŒ…ë¦¬í¬íŠ¸`;

        const workbook = new ExcelJS.Workbook();
        const sheet = workbook.addWorksheet('ì»¨ì„¤íŒ…ë¦¬í¬íŠ¸');

        sheet.columns = [
            { width: 35 }, 
            { width: 45 }, 
            { width: 30 }  
        ];

        sheet.mergeCells('A1:C1');
        const headerCell = sheet.getCell('A1');
        headerCell.value = 'STORE MANAGEMENT CONSULTING REPORT';
        headerCell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF00782B' } };
        headerCell.font = { color: { argb: 'FFFFFFFF' }, bold: true, size: 16 };
        headerCell.alignment = { horizontal: 'center', vertical: 'middle' };
        sheet.getRow(1).height = 40;

        sheet.addRow([]);
        const infoRow = sheet.addRow(['ì ê²€ì •ë³´', `ì§€ì : ${branch}  /  SC: ${sc}  /  ì¼ì: ${new Date().toLocaleDateString()}`]);
        sheet.mergeCells(`B${infoRow.number}:C${infoRow.number}`);
        infoRow.getCell(1).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF604C3E' } };
        infoRow.getCell(1).font = { color: { argb: 'FFFFFFFF' }, bold: true };
        infoRow.getCell(2).font = { bold: true };
        sheet.addRow([]);

        const addSectionHeader = (title) => {
            const row = sheet.addRow([title]);
            sheet.mergeCells(`A${row.number}:C${row.number}`);
            applySectionStyle(sheet.getCell(`A${row.number}`));
            row.height = 25;
        };

        const addDataRow = async (label, value, fileId) => {
            const row = sheet.addRow([label, value || '-']);
            applyLabelStyle(row.getCell(1));
            applyValueStyle(row.getCell(2));
            applyValueStyle(row.getCell(3)); 
            row.height = 100; // ì‚¬ì§„ ê°€ë…ì„±ì„ ìœ„í•´ ë†’ì´ ìƒí–¥

            if (fileId) {
                const fileInput = document.getElementById(fileId);
                if (fileInput && fileInput.files[0]) {
                    const base64 = await getResizedImageData(fileInput.files[0]);
                    const imageId = workbook.addImage({ base64: base64, extension: 'jpeg' });
                    sheet.addImage(imageId, {
                        tl: { col: 2.1, row: row.number - 0.95 },
                        ext: { width: 180, height: 120 }
                    });
                }
            }
        };

        addSectionHeader('Step 1. ì‹œì„¤ ë° í™˜ê²½ ì ê²€');
        await addDataRow('1. ì í¬ ì™¸ê´€ ì ìˆ˜', formData.get('s1_1_score') + 'ì ', 'file_s1_1');
        await addDataRow('2. ì í¬ ë‚´ë¶€ ì ìˆ˜', formData.get('s1_2_score') + 'ì ', 'file_s1_2');
        await addDataRow('3. ê³ ì§€ë¬¼ ì ê²€', formData.get('s1_3_score') + 'ì ', 'file_s1_3');
        await addDataRow('4. ê¸°ê¸° ê³ ì¥ ì ê²€', formData.get('s1_4_score') + 'ì ', 'file_s1_4');

        addSectionHeader('Step 2. ë§¤ì¶œ í˜„í™© ë° ë¶„ì„');
        await addDataRow('1. ëª©í‘œë§¤ì¶œ ì ê²€', formData.get('s2_1_comment'));
        await addDataRow('2. ì‹ ì œí’ˆ ë¹„ìœ¨/ì¦ê°', `${formData.get('s2_2_ratio')}% / ${formData.get('s2_2_increase')}% ì¦ê°\në¹„ê³ : ${formData.get('s2_2_comment')}`);
        await addDataRow('3. í’ˆì ˆ/ë°œì£¼ ì ê²€', formData.get('s2_3_comment'));
        await addDataRow('4. íê¸°/ë°°ë‹¬ ì ê²€', `íê¸°ìœ¨: ${formData.get('s2_4_waste')}%\në°°ë‹¬í’ˆì ˆ: ${formData.get('s2_4_time')}\në¹„ê³ : ${formData.get('s2_4_comment')}`);

        addSectionHeader('Step 3. ì†ìµ ë¶„ì„');
        await addDataRow('1. ë¶€ì§„ì  ê°œì„ ì•ˆ', formData.get('s3_1_comment'));
        await addDataRow('2. ì ì ì›ì¸ íŒŒì•…', formData.get('s3_2_comment'));

        addSectionHeader('Step 4. ì¸ì‚¬ ë° ê¸°íƒ€ ì ê²€');
        await addDataRow('1. ì£¼ 52ì‹œê°„ ì¤€ìˆ˜', formData.get('s4_overtime'));
        await addDataRow('2. ì£¼ 6ì¼ ê·¼ë¬´ ë°œìƒ', formData.get('s4_work6days'));
        await addDataRow('3. ì§ì› ë©´ë‹´ ì‹¤ì‹œ', formData.get('s4_interview_yn') === 'on' ? 'ì‹¤ì‹œ' : 'ë¯¸ì‹¤ì‹œ', 'file_interview');

        addSectionHeader('Step 5. ìƒì‚° ë° HACCP');
        await addDataRow('1. ì£¼ìš” ìˆ˜ìœ¨', `ë¯¹ìŠ¤: ${formData.get('s5_yield_mix')}% / 6X: ${formData.get('s5_yield_6x')}% / ì •ë°±ë‹¹: ${formData.get('s5_yield_sugar')}%`);
        await addDataRow('2. ê°œë‹¹ ì¸ê±´ë¹„', formData.get('s5_labor_cost') + 'ì›');
        await addDataRow('3. ê¸°ê¸° ìˆ˜ë¦¬ í™•ì¸', formData.get('s5_2_comment'), 'file_s5_machine');
        await addDataRow('4. HACCP ì„œë¥˜', formData.get('haccp_yn') === 'on' ? 'í™•ì¸ì™„ë£Œ' : 'ë¯¸ë¹„');

        const buffer = await workbook.xlsx.writeBuffer();
        const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
        return { blob, fileName };
    }

    async function saveAsExcel() {
        try {
            const { blob, fileName } = await generateExcelFile();
            saveAs(blob, `${fileName}.xlsx`);
        } catch (e) {
            alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    }

    async function sendEmail() {
        const branch = document.getElementById("branchSelect").value;
        const sc = document.getElementById("scSelect").value;
        if(!branch || !sc) {
            alert("ì§€ì ê³¼ SCë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }
        const { blob, fileName } = await generateExcelFile();
        saveAs(blob, `${fileName}.xlsx`);

        const subject = `[ì œì¶œ] ${fileName}`;
        const body = `ì§€ì ëª…: ${branch}\në‹´ë‹¹ SC: ${sc}\n\në¦¬í¬íŠ¸ íŒŒì¼(${fileName}.xlsx)ì„ ì²¨ë¶€í•˜ì—¬ ë°œì†¡í•©ë‹ˆë‹¤.`;
        setTimeout(() => {
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }, 1200);
    }
</script>

</body>
</html>
